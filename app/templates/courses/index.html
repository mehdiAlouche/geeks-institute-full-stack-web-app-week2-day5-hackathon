{% extends "base.html" %}

{% block title %}Courses - School Management System{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <div class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-4 py-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Courses</h1>
          <p class="mt-2 text-gray-600">Discover and enroll in our comprehensive course offerings</p>
        </div>
        <div class="flex space-x-3">
          <button class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors" id="filter-btn">
            <i class="bi bi-funnel mr-2"></i>
            Filter
          </button>
          <a href="/courses/create" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" id="create-course-btn" style="display: none;">
            <i class="bi bi-plus-circle mr-2"></i>
            Create Course
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="max-w-7xl mx-auto px-4 py-6 hidden" id="filters-panel">
    <div class="bg-white rounded-lg shadow-md p-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
          <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="">All Categories</option>
            <option value="web-dev">Web Development</option>
            <option value="mobile">Mobile Development</option>
            <option value="data-science">Data Science</option>
            <option value="design">Design</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Level</label>
          <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="">All Levels</option>
            <option value="beginner">Beginner</option>
            <option value="intermediate">Intermediate</option>
            <option value="advanced">Advanced</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
          <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="">All Status</option>
            <option value="published">Published</option>
            <option value="draft">Draft</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
          <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="popular">Most Popular</option>
            <option value="title">Title A-Z</option>
          </select>
        </div>
      </div>
      <div class="flex justify-end mt-4 space-x-3">
        <button class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
          Clear Filters
        </button>
        <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
          Apply Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="max-w-7xl mx-auto px-4 pb-6">
    <div class="relative">
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <i class="bi bi-search text-gray-400"></i>
      </div>
      <input 
        type="text" 
        class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
        placeholder="Search courses..."
        id="search-input"
      >
    </div>
  </div>

  <!-- Courses Grid -->
  <div class="max-w-7xl mx-auto px-4 pb-12">
    <course-list></course-list>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Show/hide Create Course button based on user role
  document.addEventListener('DOMContentLoaded', function() {
    // Refresh navbar first to ensure auth state is current
    if (window.SchoolApp) {
      window.SchoolApp.refreshNavbar();
    }
    
    // Then check user role for Create Course button
    const user = window.SchoolApp?.getCurrentUser();
    const createCourseBtn = document.getElementById('create-course-btn');
    
    if (user && (user.role === 'teacher' || user.role === 'admin') && createCourseBtn) {
      createCourseBtn.style.display = 'block';
    }
  });

  // Toggle filters panel
  document.getElementById('filter-btn').addEventListener('click', function() {
    const panel = document.getElementById('filters-panel');
    panel.classList.toggle('hidden');
  });

  // Search functionality
  let searchTimeout;
  document.getElementById('search-input').addEventListener('input', function(e) {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      const searchTerm = e.target.value.toLowerCase();
      const courseCards = document.querySelectorAll('course-card');
      
      courseCards.forEach(card => {
        const title = card.getAttribute('title').toLowerCase();
        const description = card.getAttribute('description').toLowerCase();
        
        if (title.includes(searchTerm) || description.includes(searchTerm)) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    }, 300);
  });
</script>
{% endblock %}
